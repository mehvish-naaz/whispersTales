<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Stories</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Italianno&family=Quicksand:wght@300..700&display=swap"
        rel="stylesheet">
    <style>
        #storyContainer {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 10px;
        }

        .story-card {
            background-color: #fffaf9;
            border: 1px solid #e9969f;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .story-card:hover {
            transform: translateY(-5px);
        }

        .story-card h3 {
            font-family: Quicksand, cursive;
            margin-bottom: 8px;
        }

        .story-card p {
            margin-bottom: 10px;
            color: #564335;
        }

        .story-card a {
            display: inline-block;
            margin-top: 5px;
            color: #fff;
            background-color: #e9969f;
            padding: 8px 12px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
        }

        .story-card a:hover {
            background-color: #d17b84;
        }

        .story-card.read {
            opacity: 0.7;
        }

        #backToTop {
            display: none;
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 999;
            background-color: #e9969f;
            color: white;
            border: none;
            outline: none;
            padding: 12px 16px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        #backToTop:hover {
            background-color: #d97c88;
            transform: scale(1.1);
        }
        .mark-read-btn{
        font-size: 12px;
        }
    </style>
</head>

<body>


    <header>
        <div class="head">WhispersTales</div>
    </header>
    <!-- <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="stories.html">Stories</a></li>
            <li><a href="about.html">About</a></li>
            <li><a href="contact.html">Contact</a></li>
        </ul>
    </nav> -->
    <nav>
        <ul>
            <li>
                <a href="index.html">
                    <!-- Home SVG -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                        viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 6px;">
                        <path d="M12 3l9 8h-3v9h-12v-9h-3z" />
                    </svg>
                    Home
                </a>
            </li>
            <li>
                <a href="stories.html">
                    <!-- Stories SVG (list icon) -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                        viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 6px;">
                        <path d="M3 4h18v2h-18zM3 9h18v2h-18zM3 14h12v2h-12z" />
                    </svg>
                    Stories
                </a>
            </li>
            <li>
                <a href="about.html">
                    <!-- About SVG (user icon) -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                        viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 6px;">
                        <path
                            d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                    </svg>
                    About
                </a>
            </li>
            <li>
                <a href="contact.html">
                    <!-- Contact SVG (envelope icon) -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                        viewBox="0 0 24 24" style="vertical-align: middle; margin-right: 6px;">
                        <path
                            d="M20 4h-16c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-12c0-1.1-.9-2-2-2zm0 4l-8 5-8-5v-2l8 5 8-5v2z" />
                    </svg>
                    Contact
                </a>
            </li>
        </ul>
    </nav>

    <h1 style="text-align: center; color: #f19396;">All Stories</h1>




    <div id="filters">
        <input type="text" id="searchInput" placeholder="Search stories...">
        <select id="genreSelect">
            <option value="">All Genres</option>
        </select>
    </div>

    <main id="storyContainer"></main>

    <button id="backToTop" title="Go to top">⮝</button>
    <script>
        let stories = [];

        const container = document.getElementById('storyContainer');
        const searchInput = document.getElementById('searchInput');
        const genreSelect = document.getElementById('genreSelect');

        // Fetch stories
        fetch('stories.json')
            .then(response => response.json())
            .then(data => {
                stories = data;

                // Populate genre dropdown dynamically
                const genresSet = new Set();
                stories.forEach(s => {
                    if (Array.isArray(s.genre)) {
                        s.genre.forEach(g => genresSet.add(g));
                    } else if (s.genre) {
                        genresSet.add(s.genre);
                    }
                });
                genresSet.forEach(g => {
                    const option = document.createElement('option');
                    option.value = g;
                    option.textContent = g;
                    genreSelect.appendChild(option);
                });

                displayStories(stories);
            });

        function displayStories(list) {
            container.innerHTML = '';

            // Sort alphabetically by title
            list.sort((a, b) => a.title.localeCompare(b.title));

            list.forEach((story, index) => {
                const card = document.createElement('div');
                card.className = 'story-card fade-out';

                // Mark as read
                const readStories = JSON.parse(localStorage.getItem("readStories") || "[]");
                const isRead = readStories.includes(story.id);
                if (isRead) card.classList.add("read");

                card.innerHTML = `
            <h3>${index + 1}. ${story.title}</h3>
            <p><em>${Array.isArray(story.genre) ? story.genre.join(", ") : story.genre || ""} | ${story.author || ""}</em></p>
            <p>${story.summary || ""}</p>
            <a href="story.html?id=${story.id}">Read More →</a>
            <button class="mark-read-btn">${isRead ? "✔ Read" : "Mark as Read"}</button>
        `;

                container.appendChild(card);
                setTimeout(() => card.classList.remove("fade-out"), 50);

                // Mark as read button
                const btn = card.querySelector(".mark-read-btn");
                btn.addEventListener("click", () => {
                    let readStories = JSON.parse(localStorage.getItem("readStories") || "[]");
                    if (!readStories.includes(story.id)) {
                        readStories.push(story.id);
                        localStorage.setItem("readStories", JSON.stringify(readStories));
                    }
                    card.classList.add("read");
                    btn.textContent = "✔ Read";
                    btn.disabled = true;
                });
            });
        }


        // Search stories
        searchInput.addEventListener('input', () => {
            const term = searchInput.value.toLowerCase();
            const filtered = stories.filter(s =>
                s.title.toLowerCase().includes(term) || (s.author || "").toLowerCase().includes(term)
            );
            displayStories(filtered);
        });

        // Filter by genre
        genreSelect.addEventListener('change', () => {
            const genre = genreSelect.value;
            const filtered = genre === "" ? stories : stories.filter(s =>
                Array.isArray(s.genre) ? s.genre.includes(genre) : s.genre === genre
            );
            displayStories(filtered);
        });
    </script>


    <script>
        // Show or hide the button when scrolling
        const btn = document.getElementById("backToTop");
        window.onscroll = function () {
            if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
                btn.style.display = "block";
            } else {
                btn.style.display = "none";
            }
        };

        // Smooth scroll to top when clicked
        btn.onclick = function () {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };
    </script>


</body>

</html>